<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Scriptlist</title>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/json2.js"></script>
<script type="text/javascript">
function setup(){
	refreshList();
}
function refreshList(){
	tabSwitch(0);
	$.post('/list', function(data){
		var J = JSON.parse(data);
		var o = J[0];
		var s = J[1];
		var d = J[2];
		var c = document.getElementById('mineContent');
		c.innerHTML = "";
		if (o.length==0)c.innerHTML="You Have No Scripts.";
		else{
			for (i in o){
				var resource_id = o[i][0];
				var title = o[i][1];
				var updated = o[i][2];
				var permission = o[i][3];
				var shared_with = o[i][4];
				var entry = c.appendChild(document.createElement('div'));
				entry.className='entry';
				var titleDiv = entry.appendChild(document.createElement('div'));
				titleDiv.appendChild(document.createTextNode(title));
				//control div
				var controlDiv = entry.appendChild(document.createElement('div'));
				var e = controlDiv.appendChild(document.createElement("input"));
				e.addEventListener("click",emailPrompt, false);
				e.title = resource_id;
				e.type="button";
				e.value = "Email"
				//share script
				var sh = controlDiv.appendChild(document.createElement("input"));
				sh.type="button";
				sh.id = resource_id;
				sh.title = shared_eith.join(",");
				sh.addEventListener("click",sharePrompt, false);
				sh.value = "Share"
				//title page
				var t = controlDiv.appendChild(document.createElement('input'));
				t.type="button";
				t.value="Edit Title Page";
				t.addEventListener("click", titlePage, false);
				t.title = resource_id;
				
			}
		}
		var c = document.getElementById('othersContent');
		c.innerHTML = "";
		if (o.length==0)c.innerHTML="No One is Sharing Scripts With You.";
		else{
			for(i in s){
				var resource_id = s[i][0];
				var title = s[i][1];
				var updated = s[i][2];
				var owner = s[i][3];
			}
		}
	
							 });
}
function tabSwitch(v){
	var t = ["mine","others","deleted"];
	for (i in t){
		if (i*1==v*1){
			document.getElementById(t[v]).style.backgroundColor="#6484DF";
			document.getElementById(t[v]+"Content").style.display="block";
		}
		else{
			document.getElementById(t[i]).style.backgroundColor="#A2BAE9";
			document.getElementById(t[i]+"Content").style.display="none";
		}
	}
}
function sharePrompt(){
	
}
function titlePage(){
	window.open("titlepage?resource_id="+this.title)
}
function script(v){
url = '/editor?resource_id=' + v;
window.open(url);
}
function renameScript(){
	var resource_id = document.getElementById('resource_id').innerHTML;
	var id = "name"+resource_id;
	var nameCell = document.getElementById(id);
	var rename = document.getElementById('rename').value;
	if (rename!=""){
		$.post("/rename", {resource_id : resource_id, rename : rename});
		nameCell.innerHTML = rename;
	}
	document.getElementById('rename').value = "";
	document.getElementById('resource_id').innerHTML = "";
	document.getElementById('renamePrompt').style.display= 'block';
	
	}
function deleteScript(v){
	var script = document.getElementById(v);
	script.style.backgroundColor = '#ccc';
	script.style.opacity = '0.5';
	$.post("/delete", {resource_id : v}, function(){script.parentNode.removeChild(script);});
	}

function exportScript(v){
url = '/export?resource_id=' + v + '&export_format=pdf';
window.open(url);
}

function emailScript(){
	var arr = new Array();
	var c = document.getElementsByTagName('span');
	for(var i=0;i<c.length; i++){
		if (c[i].className=='mailto'){
			arr.push(c[i].innerHTML);
			}
		}
	var recipients = arr.join(',');
	var subject = document.getElementById('subject').value;
	var body_message = document.getElementById('message').value;
	$.post("/emailscript", {resource_id : resource_id, recipients : recipients, subject :subject, body_message:body_message});
	hideEmailDiv();
}
function emailPrompt(){
	resource_id=this;
	document.getElementById('emailPrompt').style.display = 'block';
}
function renamePrompt(v){
	var nameId = "name"+v;
	var name = document.getElementById(nameId).innerHTML;
	document.getElementById('renamePrompt').style.display = 'block';
	document.getElementById('resource_id').innerHTML = v;
	document.getElementById('renameName').innerHTML = name;
}
function hideEmailDiv(){
document.getElementById('emailPrompt').style.display = 'none';
document.getElementById('recipient').value = "";
document.getElementById('subject').value = "";
document.getElementById('message').value = "";
document.getElementById('recipients').innerHTML = "";
}
function hideRenameDiv(){
document.getElementById('renamePrompt').style.display = 'none';
document.getElementById('rename').value = "";
}
function showActions(v){
	var a = document.getElementById(v).style.display;
	var c = document.getElementsByTagName('div');
	for(var i=0; i<c.length; i++){
		if(c[i].className=='actions'){c[i].style.display = 'none';}
		if(c[i].className!='popup_block'){c[i].parentNode.style.backgroundColor = 'white';}
		}
	
	if(a == 'none'){
		document.getElementById(v).style.display = 'block';
		document.getElementById(v).parentNode.style.backgroundColor = '#90A6D8';
		}
	else {document.getElementById(v).style.display = 'none';}
	
	
	}
</script>
<style>
body{
	margin:0; 
	padding:0;
	font-family:sans-serif;
}
.tab{
	border:1px #333 solid;
	background-color:#A2BAE9;
}
.TEXT{
	font-size:24px;
  border-style:inset; 
  border-width:2px; 
}
.token{
	background-color:#ddd;
	padding:3px;
	margin:3px;
	float:none;
	font:Verdana, Geneva, sans-serif;
	-moz-border-radius: 5px; 
	-webkit-border-radius: 5px;
	float:left;
	}
.token a{
	text-decoration:none;
	color:#000;
}
.name{
	font-size:30px;;
}
.mailto{
	display:none;
}
.entry{
	padding:6px;
	border:ridge;
}
.title{
	font-size:180%;
}
.btn{
	padding-right:10px;
	font-size:150%;
}
</style>
</head>

<body onload="setup()">
<b id="user">{{  user  }}</b>  |  <a href="{{ sign_out }}" class="user" style="font-size:100%">Sign Out</a>

		<div style="border:ridge;">
			<div style="border-bottom:3px #999999 solid; background-color:#ddd; padding:3px; font-size:100%">RawScripts</div>
			<table id='tabs' width=100%>
				<tr>
					<td align="center" width=33% id="mine" class="tab" onclick="tabSwitch(0)">Mine</td>
					<td align="center" width=33% id="others" class="tab" onclick="tabSwitch(1)">Others'</td>
					<td align="center" width=33% id="deleted" class="tab" onclick="tabSwitch(2)">Deleted</td>
				</tr>
			</table>
			<div id="mineContent" style="display:none">Loading...</div>
			<div id="othersContent" style="display:none">Loading...</div>
			<div id="deletedContent" style="display:none">Loading...</div>
		</div>

<div id="emailPrompt" style="background-color:#7694D8; display:none; position:absolute; height:100%; top:0; left:0;  z-index:100; width:100%" >
	<div class="popup_block" style="width:100%; position:relative; margin:auto; top:10%; padding:10px; border:double">
		<div class="popup">
			<a href="javascript:hideEmailDiv()" style="color:#333">Close</a>
			<br /><br />
            Email Script
            <br /><br />
			Recipients (max 5, comma seperated)
			<br />
            <div id="recipients"></div>
			<input class="TEXT" type='text' name='recipient' id='recipient' />
			<br />
			Subject
			<br />
			<input class="TEXT" type='text' name='subject' id='subject' />
			<br />
			Message (optional)
			<br />
			<textarea class="TEXT" name='message' id='message'></textarea>
			<br />
			<input type='button' class="btn" onClick='emailScript()' value='Send' />
			<br />
			<b>Note:</b> you will automatically get a copy yourself
		</div>
	</div>
</div>
<div id="renamePrompt" style="background-color:#7694D8; display:none; position:absolute; height:100%; top:0; left:0;  z-index:100">
	<div class="popup_block" style="background:#7694D8; width:90%; position:relative; margin:auto; top:30%; padding:10px; border:double">
		<div class="popup">
			<a href="javascript:hideRenameDiv()" style="color:#333">Close</a>
            <br /><br />
			Rename <b id="renameName"></b>
			<br /><br />
			<input class="TEXT" type='text' name='rename' id='rename' />
			<br />
			<input type='button' class="btn" onClick='renameScript()' value='Save' />
            <div id="resource_id" style="display:none"></div>
			
		</div>
	</div>
</div>
</body>
</html>
