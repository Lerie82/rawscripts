$(document).ready(function(){document.getElementById("script").style.height=$("#container").height()-65+"px";document.getElementById("script").style.width=$("#container").width()-350+"px";document.getElementById("sidebar").style.height=($("#container").height()-65)+"px";$(":radio").click(function(){radioClick(this)})});$(window).resize(function(){document.getElementById("script").style.height=$("#container").height()-65+"px";document.getElementById("script").style.width=$("#container").width()-350+"px";document.getElementById("sidebar").style.height=($("#container").height()-65)+"px"});function setup(){resource_id=window.location.href.split("=")[1];var h=document.getElementsByTagName("input");var l=h[h.length-1].value.substr(1);if(l!="1"){$.post("/revisionlist",{resource_id:resource_id,version:l},function(c){buildTable(c)})}var h=document.getElementsByTagName("input");var b=0;var a=false;for(i in h){if(h[i].type=="radio"&&h[i].value.substr(0,1)==2){if(!a){h[i].checked=true;a=true;var k=h[i].value;var f=h[i];while(f.nodeName!="TR"){f=f.parentNode}var m=f.id}else{h[i].disabled=true;h[i].style.visibility="hidden"}}else{if(h[i].type=="radio"&&h[i].value.substr(0,1)==1){if(b==0){h[i].disabled=true;h[i].style.visibility="hidden";b++}else{if(b==1){h[i].checked=true;b++;var e=h[i].value;var f=h[i];while(f.nodeName!="TR"){f=f.parentNode}var g=f.id}}}}}compareVersions(k,m,e,g)}function radioSetup(){var e=document.getElementsByTagName("input");var d=false;var b=false;var a=false;for(i in e){if(e[i].type=="radio"){if(e[i].checked&&e[i].value.substr(0,1)==1){d=true}if(e[i].checked&&e[i].value.substr(0,1)==2){b=true}if(!a){e[i].disabled=true;e[i].style.visibility="hidden";a=true}else{if((!d&&e[i].value.substr(0,1)==2)){e[i].disabled=false;e[i].style.visibility="visible"}else{if(b&&e[i].value.substr(0,1)==1){e[i].disabled=false;e[i].style.visibility="visible"}else{e[i].disabled=true;e[i].style.visibility="hidden"}}}}}}function radioClick(e){if(document.getElementById("sel").selectedIndex==1){var f=document.getElementsByTagName("input");for(i in f){if(f[i].type=="radio"){if(f[i].parentNode.className=="viewScript"){f[i].checked=false}}}e.checked=true;f=e;while(f.nodeName!="TR"){f=f.parentNode}changeVersion(e.value,f.id)}else{var a=e.value.substr(0,1);var f=document.getElementsByTagName("input");for(i in f){if(f[i].type=="radio"&&f[i].value.substr(0,1)==a){f[i].checked=false}if(f[i].type=="radio"&&f[i].value.substr(0,1)!=a&&f[i].checked){var d=f[i].value;var b=f[i];while(b.nodeName!="TR"){b=b.parentNode}version_two_id=b.id}}e.checked=true;b=e;while(b.nodeName!="TR"){b=b.parentNode}version_one_id=b.id;compareVersions(e.value,version_one_id,d,version_two_id);radioSetup()}}function buildTable(k){var f=document.getElementById("tb");var g=JSON.parse(k);for(i in g){var h=f.appendChild(document.createElement("tr"));h.id=g[i][0];h.className=(g[i][3]==0?"manualsave":"autosave");var c=h.appendChild(document.createElement("td"));c.align="center";c.className="viewScript";var b=c.appendChild(document.createElement("input"));b.type="radio";b.value="1"+g[i][2];c=h.appendChild(document.createElement("td"));c.align="center";c.className="compare";b=c.appendChild(document.createElement("input"));b.type="radio";b.value="2"+g[i][2];b.disabled=true;b.style.visibility="hidden";c=h.appendChild(document.createElement("td"));c.align="center";c.appendChild(document.createTextNode(g[i][2]));c=h.appendChild(document.createElement("td"));c.align="center";c.appendChild(document.createTextNode(g[i][1]));c=h.appendChild(document.createElement("td"));c.align="center";var e=c.appendChild(document.createElement("a"));e.appendChild(document.createTextNode("Copy to new script"));e.href="javascript:copyThisVersion("+g[i][2]+")";e.id=g[i][2]}$(":radio").unbind("click");$(":radio").click(function(){radioClick(this)})}function changeVersion(a,b){$.post("/revisionget",{resource_id:b,version:String(a).substr(1)},function(c){if(c=="not found"){}document.getElementById("scriptcontent").innerHTML=c})}function compareVersions(h,d,g,b){var c=(h>g?g:h);var f=(h<g?g:h);var e=(h>g?b:d);var a=(h<g?b:d);$.post("/revisioncompare",{v_o:c.substr(1),v_o_id:e,v_t:f.substr(1),v_t_id:a},function(k){if(k=="not found"){}document.getElementById("scriptcontent").innerHTML=k;context()})}function context(){var g=document.getElementById("scriptcontent").childNodes;if(document.getElementById("con").selectedIndex==1){var f=false;for(i in g){if(g[i].nodeName=="DEL"||g[i].nodeName=="INS"){if(g[i].innerHTML==""){g[i].parentNode.removeChild(g[i])}else{f=12}}else{if(g[i].nodeName=="P"){var e=g[i].childNodes;for(j in e){if(e[j].nodeName=="DEL"||e[j].nodeName=="INS"){if(e[j].innerHTML==""){e[j].parentNode.removeChild(e[j])}else{f=12}}}}}if(!f&&g[i].nodeName!="#text"&&g[i].style!=undefined){g[i].style.display="none"}if(f==12&&g[i].nodeName!="#text"){var a=i-1;var b=0;while(b<12){while(g[a]!=undefined&&g[a].nodeName=="#text"){a--}if(g[a]==undefined){b=13}else{g[a].style.display="block";a--;b++}}}if(f!=false&&f<13){if(g[i].style!=undefined){g[i].style.display="block";f--}if(f<0){f=false}}}f="none";for(i in g){if(g[i].style!=undefined){if(f=="block"&&g[i].style.display=="none"){f="none";document.getElementById("scriptcontent").insertBefore(document.createElement("hr"),g[i])}if(g[i].style.display=="block"){f="block"}}}}else{for(i in g){if(g[i].nodeName=="HR"){g[i].parentNode.removeChild(g[i])}else{if(g[i].style!=undefined){g[i].style.display="block"}}}}}function compareToggle(e){if(e==0){$(".compare").css("display","block");radioSetup();var l=document.getElementsByTagName("input");for(i in l){if(l[i].type=="radio"){if(l[i].type=="radio"&&l[i].checked){if(l[i].value.substr(0,1)==1){var b=l[i].value;var k=l[i];while(k.nodeName!="TR"){k=k.parentNode}var g=k.id}if(l[i].value.substr(0,1)==2){var h=l[i].value;var k=l[i];while(k.nodeName!="TR"){k=k.parentNode}var a=k.id}}}}compareVersions(b,g,h,a);document.getElementById("key").style.display="block"}if(e==1){$(".compare").css("display","none");var l=document.getElementsByTagName("input");for(i in l){if(l[i].type=="radio"){l[i].disabled=false;l[i].style.visibility="visible";if(l[i].type=="radio"&&l[i].checked&&l[i].value.substr(0,1)==1){var e=l[i].value;var k=l[i];while(k.nodeName!="TR"){k=k.parentNode}var f=k.id}}}changeVersion(e,f);document.getElementById("key").style.display="none"}}function copyThisVersion(a){console.log(a);var b=document.getElementById(a);while(b.nodeName!="TR"){b=b.parentNode}console.log(b.id);$.post("/revisionduplicate",{resource_id:b.id,version:a},function(c){window.open(c)})}function toggleAutosave(a){var b=document.getElementsByTagName("tr");if(a){for(i in b){if(b[i].className=="autosave"){b[i].style.display="none"}}}else{for(i in b){if(b[i].className=="autosave"){b[i].style.display="table-row"}}}}function duplicate(){$.post("/duplicate",{resource_id:resource_id,fromPage:"editor"},function(a){if(a=="fail"){return}else{window.open(a)}})}function exportPrompt(){document.getElementById("exportpopup").style.visibility="visible"}function hideExportPrompt(){typeToScript=true;document.getElementById("exportpopup").style.visibility="hidden"}function exportScripts(){var e=window.location.href;var g=e.split("=")[1];if(g=="demo"){nope();return}else{var k;var h="&title_page="+document.getElementById("et").selectedIndex;var f=document.getElementsByTagName("input");for(var l=0;l<f.length;l++){if(f[l].checked==true){if(f[l].className=="exportList"){k=f[l].name;e="/export?resource_id="+g+"&export_format="+k+"&fromPage=editor"+h;window.open(e)}}}}};