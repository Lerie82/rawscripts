var pageBreaks=[];var mouseX=0;var mouseY=0;var shiftDown=false;var mouseDownBool=false;var scrollBarBool=false;var characters=[];var scenes=[];var canvas;var ctx;var linesNLB=[];var vOffset=0;var pos={col:0,row:0};var anch={col:0,row:0};var background="#fff";var font="10pt Courier";var fontWidth=8;var foreground="#000";var lineheight=13;var milli=0;var formatMenu=false;var formats=["Slugline","Action","Character","Dialog","Parenthetical","Transition"];var WrapVariableArray=[[62,111+50,0,1,2],[62,111+50,0,0,2],[40,271+50,0,1,1],[36,191+50,0,0,2],[30,231+50,0,0,1],[61,601+50,1,1,2]];var editorWidth=850;function setup(){var b=document.getElementById("canvas");var a=b.getContext("2d");document.onkeypress=handlekeypress;characterInit();sceneIndex();paint(false,false,true,false);setInterval("paint(false,false, false,false)",40)}function mouseUp(j){mouseDownBool=false;scrollBarBool=false;var h=document.getElementById("canvas").width;var f=document.getElementById("canvas").height;if(!formatMenu){if(j.clientX>10&&j.clientX<100&&j.clientY<30&&j.clientY>10){formatMenu=true}else{if(j.clientY>f-39&&j.clientY<f&&j.clientX>editorWidth-22&&j.clientX<editorWidth-2){if(j.clientY>f-20){scroll(30)}else{scroll(-30)}}else{}}}else{if(j.clientX>10&&j.clientX<110&&j.clientY<150&&j.clientY>10){var g=j.clientY;var d=25;var k=19;if(g<d){lines[pos.row][1]=0}else{if(g<(d+k)){lines[pos.row][1]=1}else{if(g<(d+2*k)){lines[pos.row][1]=2}else{if(g<(d+3*k)){lines[pos.row][1]=3}else{if(g<(d+4*k)){lines[pos.row][1]=4}else{lines[pos.row][1]=5}}}}}}formatMenu=false}if(j.clientX>200&&j.clientX<310&&j.clientY<27&&j.clientY>7){paint(false,false,true,false);jumpTo()}}function mouseDown(l){var f=document.getElementById("canvas").height;var j=(pageBreaks.length+1)*74*lineheight;var k=((f-35)/j)*(f-35-39);if(k<20){k=20}if(k>=f-35-39){k=f-35-39}var h=(vOffset/(j-f))*(f-35-39-k)+35;if(formatMenu){if(l.clientX>10&&l.clientX<110&&l.clientY<150&&l.clientY>10){var g=l.clientY;var d=25;var m=19;if(g<d){lines[pos.row][1]=0}else{if(g<(d+m)){lines[pos.row][1]=1}else{if(g<(d+2*m)){lines[pos.row][1]=2}else{if(g<(d+3*m)){lines[pos.row][1]=3}else{if(g<(d+4*m)){lines[pos.row][1]=4}else{lines[pos.row][1]=5}}}}}}formatMenu=false}else{if(l.clientX>30&&l.clientX<editorWidth-100&&l.clientY>40){mouseDownBool=true;paint(false,l,false,false)}else{if(l.clientX<editorWidth&&l.clientX>editorWidth-20&&l.clientY>h&&l.clientY<h+k){scrollBarBool=true}}}}function mouseMove(a){if(scrollBarBool){scrollBarDrag(a)}mouseX=a.clientX;mouseY=a.clientY;if(mouseDownBool){paint(a,false,false,true)}}function scrollBarDrag(d){var c=mouseY-d.clientY;var a=document.getElementById("canvas").height;var b=(pageBreaks.length+1)*74*lineheight;vOffset-=b/a*c;if(vOffset<0){vOffset=0}var b=(pageBreaks.length+1)*74*lineheight-document.getElementById("canvas").height;if(vOffset>b){vOffset=b}}function scroll(a){vOffset+=a;if(vOffset<0){vOffset=0}var b=(pageBreaks.length+1)*74*lineheight-document.getElementById("canvas").height;if(vOffset>b){vOffset=b}}function jumpTo(){var b=0;for(var a=0;a<pos.row;a++){for(var c=0;c<pageBreaks.length;c++){if(pageBreaks[c][0]==a){b+=lineheight*(56-pageBreaks[c][1]+17)}}b+=(linesNLB[a].length*lineheight)}vOffset=b}function upArrow(){if(pos.row==0&&pos.col==0){return}var g=lines[pos.row][1];if(g==0){var f=WrapVariableArray[0]}else{if(g==1){var f=WrapVariableArray[1]}else{if(g==2){var f=WrapVariableArray[2]}else{if(g==3){var f=WrapVariableArray[3]}else{if(g==4){var f=WrapVariableArray[4]}else{if(g==5){var f=WrapVariableArray[5]}}}}}}if(lines[pos.row][0].length>f[0]){var h=lines[pos.row][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var j=0;while(h.slice(a,a+j).join().length<f[0]){j++}b.push(h.slice(a,a+j-1).join().length);a+=j-1}}j=0;var e=b[0];while(e<pos.col){j++;e+=b[j]+1}if(j==0){var c=lines[pos.row-1][1];if(c==0){var d=WrapVariableArray[0]}else{if(c==1){var d=WrapVariableArray[1]}else{if(c==2){var d=WrapVariableArray[2]}else{if(c==3){var d=WrapVariableArray[3]}else{if(c==4){var d=WrapVariableArray[4]}else{if(c==5){var d=WrapVariableArray[5]}}}}}}if(lines[pos.row-1][0].length<d[0]){pos.row--;if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{var h=lines[pos.row-1][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var j=0;while(h.slice(a,a+j).join().length<f[0]){j++}b.push(h.slice(a,a+j-1).join().length);a+=j-1}}pos.row--;pos.col+=lines[pos.row][0].length-b[b.length-1];if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}else{pos.col-=b[j-1]+1;if(pos.col>(e-b[j]-1)){pos.col=e-b[j]-1}}}else{if(pos.row==0){pos.col=0}else{var c=lines[pos.row-1][1];if(c==0){var d=WrapVariableArray[0]}else{if(c==1){var d=WrapVariableArray[1]}else{if(c==2){var d=WrapVariableArray[2]}else{if(c==3){var d=WrapVariableArray[3]}else{if(c==4){var d=WrapVariableArray[4]}else{if(c==5){var d=WrapVariableArray[5]}}}}}}if(lines[pos.row-1][0].length<d[0]){pos.row--;if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{var h=lines[pos.row-1][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var j=0;while(h.slice(a,a+j).join().length<f[0]){j++}b.push(h.slice(a,a+j-1).join().length);a+=j-1}}pos.row--;pos.col+=lines[pos.row][0].length-b[b.length-1];if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}paint(false,false,false,true)}function downArrow(){if(pos.row==lines.length-1&&pos.col==lines[pos.row][0].length){return}var d=lines[pos.row][1];if(d==0){var c=WrapVariableArray[0]}else{if(d==1){var c=WrapVariableArray[1]}else{if(d==2){var c=WrapVariableArray[2]}else{if(d==3){var c=WrapVariableArray[3]}else{if(d==4){var c=WrapVariableArray[4]}else{if(d==5){var c=WrapVariableArray[5]}}}}}}if(lines[pos.row][0].length>c[0]){var b=lines[pos.row][0].split(" ");var f=0;var g=[];while(f<b.length){if(b.slice(f).join().length<=c[0]){g.push(b.slice(f).join().length);f=b.length}else{var a=0;while(b.slice(f,f+a).join().length<c[0]){a++}g.push(b.slice(f,f+a-1).join().length);f+=a-1}}a=0;var h=g[0];while(h<pos.col){a++;h+=g[a]+1}if(a+1==g.length){for(var e=0;e<g.length-1;e++){pos.col-=g[e]}pos.col--;pos.row++;if(pos.row>lines.length-1){pos.row--;pos.col=lines[pos.row][0].length}if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{pos.col+=g[a]+1;if(pos.col>(h+g[a+1]+1)){pos.col=h+g[a+1]+1}}}else{if(pos.row==lines.length-1){pos.col=lines[pos.row][0].length}else{pos.row++;if(pos.row>lines.length-1){pos.row=lines.length-1}if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}paint(false,false,false,true)}function leftArrow(){if(pos.row==0&&pos.col==0){return}if(pos.col==0){pos.row--;pos.col=lines[pos.row][0].length}else{pos.col=pos.col-1}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function rightArrow(){if(pos.col==lines[pos.row][0].length&&pos.row==lines.length-1){return}if(pos.col==lines[pos.row][0].length){pos.row++;pos.col=0}else{pos.col=pos.col+1}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function backspace(h){h.preventDefault();var f=false;var a=false;if(lines[pos.row][1]==0){var a=true}if(pos.row==anch.row&&pos.col==anch.col){if(pos.col==0&&pos.row==0){return}if(lines[pos.row][1]==4&&lines[pos.row][0]=="()"){lines.splice(pos.row,1);pos.row--;pos.col=lines[pos.row][0].length;anch.row=pos.row;anch.col=pos.col}else{if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var d=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=d;pos.row--;f=true}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}}anch.col=pos.col;anch.row=pos.row}else{var g=false;if(anch.row>pos.row){g=true}if(anch.row==pos.row&&anch.col>pos.col){g=true}if(g){var c=anch.row;anch.row=pos.row;pos.row=c;c=anch.col;anch.col=pos.col;pos.col=c}while(pos.col!=anch.col||pos.row!=anch.row){if(lines[pos.row][1]==0){a=true}if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var d=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=d;pos.row--;f=true}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}}}paint(false,false,f,false);if(a){sceneIndex()}}function deleteButton(){var a=false;var e=false;if(pos.row==anch.row&&pos.col==anch.col){if(lines[pos.row][1]==0){var a=true}if(pos.col==(lines[pos.row][0].length)&&pos.row==lines.length-1){return}if(lines[pos.row][1]==4&&lines[pos.row][0]=="()"){lines.splice(pos.row,1);pos.col=0;anch.col=0}else{if(pos.col==(lines[pos.row][0].length)){if(lines[pos.row+1][1]==0){a=true}var b=lines[pos.row+1][0];lines.splice((pos.row+1),1);lines[pos.row][0]+=b;e=true}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col)+lines[pos.row][0].slice(pos.col+1)}}}else{var f=false;if(anch.row>pos.row){f=true}if(anch.row==pos.row&&anch.col>pos.col){f=true}if(f){var d=anch.row;anch.row=pos.row;pos.row=d;d=anch.col;anch.col=pos.col;pos.col=d}while(pos.col!=anch.col||pos.row!=anch.row){if(lines[pos.row][1]==0){a=true}if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var c=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=c;pos.row--;e=true}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}}}paint(false,false,e,false);if(a){sceneIndex()}}function enter(){if(lines[pos.row][1]==2){characterIndex(lines[pos.row][0])}var b=lines[pos.row][0].slice(0,pos.col);var a=lines[pos.row][0].slice(pos.col);lines[pos.row][0]=b;if(lines[pos.row][1]==0){var c=1}else{if(lines[pos.row][1]==1){var c=2}else{if(lines[pos.row][1]==2){var c=3}else{if(lines[pos.row][1]==4){var c=3}else{if(lines[pos.row][1]==3){var c=2}else{if(lines[pos.row][1]==5){var c=0}}}}}}var d=[a,c];lines.splice(pos.row+1,0,d);pos.row++;pos.col=0;anch.row=pos.row;anch.col=pos.col;paint(false,false,true,false);if(lines[pos.row][1]==1){sceneIndex()}}function tab(){var a=false;if(lines[pos.row][1]==0){var a=true}var b=lines[pos.row][1];if(b==1){lines[pos.row][1]=0;a=true}else{if(b==0){lines[pos.row][1]=2}else{if(b==2){lines[pos.row][1]=1}else{if(b==3){lines[pos.row][1]=4}else{if(b==4){lines[pos.row][1]=3}else{if(b==5){lines[pos.row][1]=0;a=true}}}}}}if(a){sceneIndex()}if(lines[pos.row][1]==4){if(lines[pos.row][0].charAt(0)!="("){lines[pos.row][0]="("+lines[pos.row][0];pos.col++;anch.col++}if(lines[pos.row][0].charAt(lines[pos.row][0].length-1)!=")"){lines[pos.row][0]=lines[pos.row][0]+")"}}if(lines[pos.row][1]==3){if(lines[pos.row][0].charAt(0)=="("){lines[pos.row][0]=lines[pos.row][0].substr(1);pos.col--;anch.col--}if(lines[pos.row][0].charAt(lines[pos.row][0].length-1)==")"){lines[pos.row][0]=lines[pos.row][0].slice(0,-1)}}}function handlekeypress(a){var b=new Date();milli=b.getMilliseconds();if(pos.row!=anch.row||pos.col!=anch.col){deleteButton()}if(a.which!=13){lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col)+String.fromCharCode(a.charCode)+lines[pos.row][0].slice(pos.col);pos.col++;if(lines[pos.row][1]==0){sceneIndex()}}anch.col=pos.col;anch.row=pos.row}function pagination(){pageBreaks=[];i=0;while(i<lines.length){lineCount=0;while(lineCount+linesNLB[i].length<56){lineCount+=linesNLB[i].length;i++;if(i==lines.length){return}}while(lines[i-1][1]==0||lines[i-1][1]==2||lines[i-1][1]==4){i--}pageBreaks.push([i,lineCount])}}function characterInit(){for(var a=0;a<lines.length;a++){if(lines[a][1]==2){characterIndex(lines[a][0])}}}function characterIndex(b){var a=b.toUpperCase();var d=false;for(var c=0;c<characters.length;c++){if(characters[c][0]==a){characters[c][1]=characters[c][1]+1;d=true}}if(!d){characters.push([a,1])}}function sceneIndex(){scenes=[];var a=0;for(var b=0;b<lines.length;b++){if(lines[b][1]==0){a++;scenes.push(String(a)+") "+lines[b][0].toUpperCase())}}}function scrollArrows(b){var a=document.getElementById("canvas").height;b.fillStyle="#333";b.fillRect(editorWidth-22,a-39,20,20);b.fillStyle="#ddd";b.fillRect(editorWidth-20,a-37,16,16);b.beginPath();b.moveTo(editorWidth-18,a-24);b.lineTo(editorWidth-12,a-35);b.lineTo(editorWidth-6,a-24);b.closePath();b.fillStyle="#333";b.fill();b.fillStyle="#333";b.fillRect(editorWidth-22,a-19,20,20);b.fillStyle="#ddd";b.fillRect(editorWidth-20,a-18,16,16);b.beginPath();b.moveTo(editorWidth-18,a-15);b.lineTo(editorWidth-12,a-4);b.lineTo(editorWidth-6,a-15);b.closePath();b.fillStyle="#333";b.fill()}function scrollBar(b,f){var a=document.getElementById("canvas").height;var d=(pageBreaks.length+1)*74*lineheight;var e=((a-35)/d)*(a-35-39);if(e<20){e=20}if(e>=a-35-39){e=a-35-39}var c=(vOffset/(d-a))*(a-35-39-e)+35;b.fillRect(editorWidth-22,c,20,e)}function drawRange(s){if(pos.row>anch.row){var p={row:anch.row,col:anch.col};var h={row:pos.row,col:pos.col}}else{if(pos.row==anch.row&&pos.col>anch.col){var p={row:anch.row,col:anch.col};var h={row:pos.row,col:pos.col}}else{var p={row:pos.row,col:pos.col};var h={row:anch.row,col:anch.col}}}var r=125;var m=0;for(var k=0;k<p.row;k++){if(pageBreaks.length!=0&&pageBreaks[m][0]-1==k){r+=lineheight*(56-pageBreaks[m][1]+17);m++;if(m==pageBreaks.length){m--}}r+=lineheight*linesNLB[k].length}var k=0;var q=linesNLB[p.row][k]+1;while(p.col>q){r+=lineheight;k++;q+=linesNLB[p.row][k]+1}q-=linesNLB[p.row][k]+1;var l=WrapVariableArray[lines[p.row][1]][1];l+=((p.col-q)*fontWidth);r+=lineheight;var d=125;m=0;for(var g=0;g<h.row;g++){if(pageBreaks.length!=0&&pageBreaks[m][0]-1==g){d+=lineheight*(56-pageBreaks[m][1]+17);m++;if(m==pageBreaks.length){m--}}d+=lineheight*linesNLB[g].length}var g=0;var n=linesNLB[h.row][g]+1;while(h.col>n){d+=lineheight;g++;n+=linesNLB[h.row][g]+1}n-=linesNLB[h.row][g]+1;var b=WrapVariableArray[lines[h.row][1]][1];b+=((h.col-n)*fontWidth);d+=lineheight;s.fillStyle="lightBlue";if(d==r){var f=l;if(lines[p.row][1]==5){f-=(lines[p.row][0].length*fontWidth)}s.fillRect(f,r-vOffset,b-l,12)}else{var c=l;if(lines[p.row][1]==5){c-=(lines[p.row][0].length*fontWidth)}s.fillRect(c,r-vOffset,(q+linesNLB[p.row][k]-p.col)*fontWidth,12);while(r+lineheight<d){for(var a=0;a<pageBreaks.length;a++){if(pageBreaks.length!=0&&pageBreaks[a][0]-1==p.row&&k==linesNLB[p.row].length-1){r+=lineheight*(56-pageBreaks[a][1]+17)}}k++;r+=lineheight;if(linesNLB[p.row].length<=k){p.row++;k=0}var e=WrapVariableArray[lines[p.row][1]][1];if(lines[p.row][1]==5){e-=(lines[p.row][0].length*fontWidth)}s.fillRect(e,r-vOffset,linesNLB[p.row][k]*fontWidth,12)}var o=WrapVariableArray[lines[h.row][1]][1];if(lines[h.row][1]==5){o-=(lines[h.row][0].length*fontWidth)}s.fillRect(o,d-vOffset,(h.col-n)*fontWidth,12)}}function paint(X,t,R,r){var l=document.getElementById("canvas");var p=l.getContext("2d");p.clearRect(0,0,2000,2500);p.fillStyle="#ccc";p.fillRect(0,0,editorWidth,document.getElementById("canvas").height);p.fillStyle=foreground;p.lineWidth=4;p.strokeStyle="#ddd";p.beginPath();p.moveTo(2,2);p.lineTo(2,document.getElementById("canvas").height-1);p.lineTo(editorWidth,document.getElementById("canvas").height-1);p.lineTo(editorWidth,2);p.stroke();var P=45;var N=45;for(var U=0;U<=pageBreaks.length;U++){p.fillStyle=background;p.fillRect(P,N-vOffset,editorWidth*0.85,lineheight*70);p.strokeStyle="#000";p.lineWidth=1;p.strokeRect(P,N-vOffset,Math.round(editorWidth*0.85),lineheight*70);p.strokeStyle="#999";p.strokeRect(P-2,N-vOffset-2,Math.round(editorWidth*0.85)+4,lineheight*70+4);p.fillStyle=foreground;if(U>0){p.fillText(String(U+1)+".",628,N-vOffset+85)}N+=lineheight*72}var G=124;var E=WrapVariableArray[0];p.fillStyle="#ddd";if(!R){var O=0;for(var U=0;U<lines.length;U++){if(pageBreaks.length!=0&&pageBreaks[O][0]==U){G+=lineheight*(56-pageBreaks[O][1]+17);O++;if(O==pageBreaks.length){O--}}for(var T=0;T<linesNLB[U].length;T++){G+=lineheight;if(lines[U][1]==0&&linesNLB[U][T]!=0){p.fillRect(E[1]-3,G-vOffset,61*fontWidth+6,14)}}}}p.fillStyle=foreground;if(pos.row!=anch.row||anch.col!=pos.col){drawRange(p)}p.fillStyle=foreground;p.font=font;var I=lineheight+135;var g="";var O=0;for(var U=0;U<lines.length;U++){if(lines[U][1]==4){if(lines[U][0].charAt(0)!="("){lines[U][0]="("+lines[U][0]}if(lines[U][0].charAt(lines[U][0].length-1)!=")"){lines[U][0]=lines[U][0]+")"}}if(!R){if(pageBreaks.length!=0&&pageBreaks[O][0]==U){I+=lineheight*(56-pageBreaks[O][1]+17);O++;if(O==pageBreaks.length){O--}}}if(!R&&(I-vOffset>1200||I-vOffset<0)){I+=(lineheight*linesNLB[U].length)}else{var ab=lines[U][1];var c=(t?anch.row:pos.row);if(U==pos.row){var C=I-lineheight;if(ab==1){var D=WrapVariableArray[1][1]}else{if(ab==0){var D=WrapVariableArray[0][1]}else{if(ab==3){var D=WrapVariableArray[3][1]}else{if(ab==2){var D=WrapVariableArray[2][1]}else{if(ab==4){var D=WrapVariableArray[4][1]}else{if(ab==5){var D=WrapVariableArray[5][1]}}}}}}var s=true;var k=[]}if(U==anch.row){var A=I-lineheight;var F=true;var a=[]}var V=lines[U][0];if(ab==0){var E=WrapVariableArray[0]}else{if(ab==1){var E=WrapVariableArray[1]}else{if(ab==2){var E=WrapVariableArray[2]}else{if(ab==3){var E=WrapVariableArray[3]}else{if(ab==4){var E=WrapVariableArray[4]}else{if(ab==5){var E=WrapVariableArray[5]}}}}}}var o=V.split(" ");var K=0;if(X||t){var S=[]}linesNLB[U]=[];while(K<o.length){var M=0;if(o.slice(K).join().length<E[0]){var aa=o.slice(K).join(" ");if(lines[U][1]==2&&g!=""&&lines[U][0].toUpperCase()==g.toUpperCase()){aa+=" (Cont'd)"}if(lines[U][1]==0){g=""}if(E[3]==1){aa=aa.toUpperCase()}if(E[2]==1){p.textAlign="right"}if(aa!=""){p.fillText(aa,E[1],I-vOffset)}p.textAlign="left";K=o.length;linesNLB[U].push(aa.length);I+=lineheight;if(E[4]==2){linesNLB[U].push(0);I+=lineheight}if(X||t){S.push(aa.length)}if(s){k.push(aa.length)}if(F){a.push(aa.length)}}else{var M=0;while(o.slice(K,K+M).join(" ").length<E[0]){newLineToPrint=o.slice(K,K+M).join(" ");M++;if(E[3]==1){newLineToPrint=newLineToPrint.toUpperCase()}}p.fillText(newLineToPrint,E[1],I-vOffset);linesNLB[U].push(newLineToPrint.length);I+=lineheight;K+=M-1;M=0;if(X||t){S.push(newLineToPrint.length)}if(s){k.push(newLineToPrint.length)}if(F){a.push(newLineToPrint.length)}}if(lines[U][1]==3&&U+1!=lines.length&&lines[U+1][1]==4){linesNLB[U].pop();I-=lineheight}if(X&&X.clientY<I-vOffset-lineheight&&X.clientY>I-vOffset-(linesNLB[U].length*lineheight)-lineheight){pos.row=U;pos.col=0;var M=0;var Q=I-vOffset-(linesNLB[U].length*lineheight);while(X.clientY>Q){pos.col+=linesNLB[U][M]+1;Q+=lineheight;M++}if(ab!=5){var u=Math.round(((X.clientX-E[1])/fontWidth));if(u>linesNLB[U][M]){u=linesNLB[U][M]}if(u<0){u=0}pos.col+=u}else{var u=Math.round(((E[1]-X.clientX)/fontWidth));if(u<0){u=0}pos.col-=u;pos.col+=lines[U][0].length}var B=0;for(var Z=0;Z<S.length;Z++){B+=S[Z]+1}if(pos.col<0){pos.col=0}if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}if(t&&t.clientY<I-vOffset-lineheight&&t.clientY>I-vOffset-(linesNLB[U].length*lineheight)-lineheight){anch.row=U;anch.col=0;var M=0;var Q=I-vOffset-(linesNLB[U].length*lineheight);while(t.clientY>Q){anch.col+=linesNLB[U][M]+1;Q+=lineheight;M++}if(ab!=5){var u=Math.round(((t.clientX-E[1])/fontWidth));if(u>linesNLB[U][M]){u=linesNLB[U][M]}if(u<0){u=0}anch.col+=u}else{var u=Math.round(((E[1]-t.clientX)/fontWidth));if(u<0){u=0}anch.col-=u;anch.col+=lines[U][0].length}var B=0;for(var Z=0;Z<S.length;Z++){B+=S[Z]+1}if(anch.col<0){anch.col=0}if(anch.col>lines[anch.row][0].length){anch.col=lines[anch.row][0].length}}}var s=false;var F=false}if(lines[U][1]==2){var g=lines[U][0]}}for(var H=U;H<linesNLB.length;H++){linesNLB.pop();H--}var Y=new Date();var q=Y.getMilliseconds();var v=q-milli;var h=false;if(v>0&&v<500){h=true}if(v<0&&v<-500){h=true}if(h&&k){var J=0;var n=pos.col;var m=k[J];while(pos.col>m){J++;m+=1+k[J]}m-=k[J];var w=D+((pos.col-m)*fontWidth);if(lines[pos.row][1]==5){w-=lines[pos.row][0].length*fontWidth}var L=2+C+(J*lineheight)-vOffset;p.fillRect(w,L,2,17)}var b=50;for(var U=0;U<scenes.length;U++){p.fillText(scenes[U],editorWidth+20,b);b+=lineheight}p.fillStyle="#6484df";p.fillRect(0,0,document.getElementById("canvas").width,35);p.fillStyle="#efefef";p.fillRect(10,7,110,20);p.fillStyle=foreground;p.font="12pt Arial";var W=lines[pos.row][1];if(W==0){var x="Slugline"}else{if(W==1){var x="Action"}else{if(W==2){var x="Character"}else{if(W==3){var x="Dialog"}else{if(W==4){var x="Parenthetical"}else{if(W==5){var x="Transition"}}}}}}p.fillText(x,15,23);p.font=font;p.fillStyle=foreground;p.fillRect(200,7,110,20);if(formatMenu){p.fillStyle="#efefef";p.fillRect(10,7,110,120);p.fillStyle=foreground;p.font="12pt Arial";formatMenuY=23;for(var U=0;U<formats.length;U++){p.fillText(formats[U],15,formatMenuY);formatMenuY+=19}}scrollArrows(p);scrollBar(p,I);if(t){pos.row=anch.row;pos.col=anch.col}if(mouseDownBool&&pos.row<anch.row&&mouseY<40){scroll(-20)}if(mouseDownBool&&pos.row>anch.row&&mouseY>document.getElementById("canvas").height-50){scroll(20)}if(r){if((2+C+(J*lineheight)-vOffset)>document.getElementById("canvas").height-50){scroll(45)}if((2+C+(J*lineheight)-vOffset)<45){scroll(-45)}}if(R){pagination()}};