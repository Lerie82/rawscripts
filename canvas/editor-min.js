var shiftDown=false;var characters=[];var scenes=[];var canvas;var ctx;var linesNLB=[];var vOffset=0;var pos={col:0,row:0};var anch={col:0,row:0};var background="#fff";var font="12pt Courier";var foreground="#000";var lineheight=15;var milli=0;var formatMenu=false;var formats=["Slugline","Action","Character","Dialog","Parenthetical","Transition"];var WrapVariableArray=[[61,31,0,1,2],[61,31,0,0,2],[40,232,0,1,1],[36,131,0,0,2],[30,181,0,0,1],[61,632,1,1,2]];var fontWidth=10;var editorWidth=675;function setup(){var b=document.getElementById("canvas");var a=b.getContext("2d");document.onkeypress=handlekeypress;characterInit();sceneIndex();paint(false,false,true);setInterval("paint(false,false, false)",40)}function mouseUp(i){var h=document.getElementById("canvas").width;var f=document.getElementById("canvas").height;if(!formatMenu){if(i.clientX>10&&i.clientX<100&&i.clientY<30&&i.clientY>10){formatMenu=true}else{if(i.clientY>f-39&&i.clientY<f&&i.clientX>editorWidth-22&&i.clientX<editorWidth-2){if(i.clientY>f-20){scroll(30)}else{scroll(-30)}}else{paint(i,false,false)}}}else{if(i.clientX>10&&i.clientX<110&&i.clientY<150&&i.clientY>10){var g=i.clientY;var d=25;var j=19;if(g<d){lines[pos.row][1]="s"}else{if(g<(d+j)){lines[pos.row][1]="a"}else{if(g<(d+2*j)){lines[pos.row][1]="c"}else{if(g<(d+3*j)){lines[pos.row][1]="d"}else{if(g<(d+4*j)){lines[pos.row][1]="p"}else{lines[pos.row][1]="t"}}}}}}formatMenu=false}if(i.clientX>200&&i.clientX<310&&i.clientY<27&&i.clientY>7){lines=fivePages;paint(false,false,true)}}function mouseDown(a){paint(false,a,false)}function scroll(a){vOffset+=a;if(vOffset<0){vOffset=0}}function upArrow(){if(pos.row==0&&pos.col==0){return}var g=lines[pos.row][1];if(g=="s"){var f=WrapVariableArray[0]}else{if(g=="a"){var f=WrapVariableArray[1]}else{if(g=="c"){var f=WrapVariableArray[2]}else{if(g=="d"){var f=WrapVariableArray[3]}else{if(g=="p"){var f=WrapVariableArray[4]}else{if(g=="t"){var f=WrapVariableArray[5]}}}}}}if(lines[pos.row][0].length>f[0]){var h=lines[pos.row][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var i=0;while(h.slice(a,a+i).join().length<f[0]){i++}b.push(h.slice(a,a+i-1).join().length);a+=i-1}}i=0;var e=b[0];while(e<pos.col){i++;e+=b[i]+1}if(i==0){var c=lines[pos.row-1][1];if(c=="s"){var d=WrapVariableArray[0]}else{if(c=="a"){var d=WrapVariableArray[1]}else{if(c=="c"){var d=WrapVariableArray[2]}else{if(c=="d"){var d=WrapVariableArray[3]}else{if(c=="p"){var d=WrapVariableArray[4]}else{if(c=="t"){var d=WrapVariableArray[5]}}}}}}if(lines[pos.row-1][0].length<d[0]){pos.row--;if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{var h=lines[pos.row-1][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var i=0;while(h.slice(a,a+i).join().length<f[0]){i++}b.push(h.slice(a,a+i-1).join().length);a+=i-1}}pos.row--;pos.col+=lines[pos.row][0].length-b[b.length-1];if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}else{pos.col-=b[i-1]+1;if(pos.col>(e-b[i]-1)){pos.col=e-b[i]-1}}}else{if(pos.row==0){pos.col=0}else{var c=lines[pos.row-1][1];if(c=="s"){var d=WrapVariableArray[0]}else{if(c=="a"){var d=WrapVariableArray[1]}else{if(c=="c"){var d=WrapVariableArray[2]}else{if(c=="d"){var d=WrapVariableArray[3]}else{if(c=="p"){var d=WrapVariableArray[4]}else{if(c=="t"){var d=WrapVariableArray[5]}}}}}}if(lines[pos.row-1][0].length<d[0]){pos.row--;if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{var h=lines[pos.row-1][0].split(" ");var a=0;var b=[];while(a<h.length){if(h.slice(a).join().length<=f[0]){b.push(h.slice(a).join().length);a=h.length}else{var i=0;while(h.slice(a,a+i).join().length<f[0]){i++}b.push(h.slice(a,a+i-1).join().length);a+=i-1}}pos.row--;pos.col+=lines[pos.row][0].length-b[b.length-1];if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function downArrow(){if(pos.row==lines.length-1&&pos.col==lines[pos.row][0].length){return}var d=lines[pos.row][1];if(d=="s"){var c=WrapVariableArray[0]}else{if(d=="a"){var c=WrapVariableArray[1]}else{if(d=="c"){var c=WrapVariableArray[2]}else{if(d=="d"){var c=WrapVariableArray[3]}else{if(d=="p"){var c=WrapVariableArray[4]}else{if(d=="t"){var c=WrapVariableArray[5]}}}}}}if(lines[pos.row][0].length>c[0]){var b=lines[pos.row][0].split(" ");var f=0;var g=[];while(f<b.length){if(b.slice(f).join().length<=c[0]){g.push(b.slice(f).join().length);f=b.length}else{var a=0;while(b.slice(f,f+a).join().length<c[0]){a++}g.push(b.slice(f,f+a-1).join().length);f+=a-1}}a=0;var h=g[0];while(h<pos.col){a++;h+=g[a]+1}if(a+1==g.length){for(var e=0;e<g.length-1;e++){pos.col-=g[e]}pos.col--;pos.row++;if(pos.row>lines.length-1){pos.row--;pos.col=lines[pos.row][0].length}if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}else{pos.col+=g[a]+1;if(pos.col>(h+g[a+1]+1)){pos.col=h+g[a+1]+1}}}else{if(pos.row==lines.length-1){pos.col=lines[pos.row][0].length}else{pos.row++;if(pos.row>lines.length-1){pos.row=lines.length-1}if(pos.col>lines[pos.row][0].length){pos.col=lines[pos.row][0].length}}}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function leftArrow(){if(pos.row==0&&pos.col==0){return}if(pos.col==0){pos.row--;pos.col=lines[pos.row][0].length}else{pos.col=pos.col-1}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function rightArrow(){if(pos.col==lines[pos.row][0].length&&pos.row==lines.length-1){return}if(pos.col==lines[pos.row][0].length){pos.row++;pos.col=0}else{pos.col=pos.col+1}if(!shiftDown){anch.col=pos.col;anch.row=pos.row}}function backspace(g){g.preventDefault();var a=false;if(lines[pos.row][1]=="s"){var a=true}if(pos.row==anch.row&&pos.col==anch.col){if(pos.col==0&&pos.row==0){return}if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var d=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=d;pos.row--}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}anch.col=pos.col;anch.row=pos.row}else{var f=false;if(anch.row>pos.row){f=true}if(anch.row==pos.row&&anch.col>pos.col){f=true}if(f){var c=anch.row;anch.row=pos.row;pos.row=c;c=anch.col;anch.col=pos.col;pos.col=c}while(pos.col!=anch.col||pos.row!=anch.row){if(lines[pos.row][1]=="s"){a=true}if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var d=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=d;pos.row--}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}}}if(a){sceneIndex()}}function deleteButton(){var a=false;if(pos.row==anch.row&&pos.col==anch.col){if(lines[pos.row][1]=="s"){var a=true}if(pos.col==(lines[pos.row][0].length)&&pos.row==lines.length-1){return}if(pos.col==(lines[pos.row][0].length)){if(lines[pos.row+1][1]=="s"){a=true}var b=lines[pos.row+1][0];lines.splice((pos.row+1),1);lines[pos.row][0]+=b}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col)+lines[pos.row][0].slice(pos.col+1)}}else{var e=false;if(anch.row>pos.row){e=true}if(anch.row==pos.row&&anch.col>pos.col){e=true}if(e){var d=anch.row;anch.row=pos.row;pos.row=d;d=anch.col;anch.col=pos.col;pos.col=d}while(pos.col!=anch.col||pos.row!=anch.row){if(lines[pos.row][1]=="s"){a=true}if(pos.col==0){var b=lines[pos.row][0];lines.splice(pos.row,1);var c=lines[pos.row-1][0].length;lines[pos.row-1][0]=lines[pos.row-1][0]+b;pos.col=c;pos.row--}else{lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col-1)+lines[pos.row][0].slice(pos.col);pos.col--}}}if(a){sceneIndex()}}function enter(){if(lines[pos.row][1]=="c"){characterIndex(lines[pos.row][0])}var b=lines[pos.row][0].slice(0,pos.col);var a=lines[pos.row][0].slice(pos.col);lines[pos.row][0]=b;if(lines[pos.row][1]=="s"){var c="a"}else{if(lines[pos.row][1]=="a"){var c="c"}else{if(lines[pos.row][1]=="c"){var c="d"}else{if(lines[pos.row][1]=="p"){var c="d"}else{if(lines[pos.row][1]=="d"){var c="c"}else{if(lines[pos.row][1]=="t"){var c="s"}}}}}}var d=[a,c];lines.splice(pos.row+1,0,d);pos.row++;pos.col=0;anch.row=pos.row;anch.col=pos.col;console.log(lines[pos.row][0]);if(lines[pos.row][1]=="a"){sceneIndex()}}function tab(){var a=false;if(lines[pos.row][1]=="s"){var a=true}var b=lines[pos.row][1];if(b=="a"){lines[pos.row][1]="s";a=true}else{if(b=="s"){lines[pos.row][1]="c"}else{if(b=="c"){lines[pos.row][1]="a"}else{if(b=="d"){lines[pos.row][1]="p"}else{if(b=="p"){lines[pos.row][1]="d"}else{if(b=="t"){lines[pos.row][1]="s";a=true}}}}}}if(a){sceneIndex()}}function handlekeypress(a){var b=new Date();milli=b.getMilliseconds();if(pos.row!=anch.row||pos.col!=anch.col){deleteButton()}if(a.which!=13){lines[pos.row][0]=lines[pos.row][0].slice(0,pos.col)+String.fromCharCode(a.charCode)+lines[pos.row][0].slice(pos.col);pos.col++;if(lines[pos.row][1]=="s"){sceneIndex()}}anch.col=pos.col;anch.row=pos.row}function characterInit(){for(var a=0;a<lines.length;a++){if(lines[a][1]=="c"){characterIndex(lines[a][0])}}}function characterIndex(b){var a=b.toUpperCase();var d=false;for(var c=0;c<characters.length;c++){if(characters[c][0]==a){characters[c][1]=characters[c][1]+1;d=true}}if(!d){characters.push([a,1])}}function sceneIndex(){scenes=[];var a=0;for(var b=0;b<lines.length;b++){if(lines[b][1]=="s"){a++;scenes.push(String(a)+") "+lines[b][0].toUpperCase())}}}function scrollArrows(b){var a=document.getElementById("canvas").height;b.fillStyle="#333";b.fillRect(editorWidth-22,a-39,20,20);b.fillStyle="#ddd";b.fillRect(editorWidth-20,a-37,16,16);b.beginPath();b.moveTo(editorWidth-18,a-24);b.lineTo(editorWidth-12,a-35);b.lineTo(editorWidth-6,a-24);b.closePath();b.fillStyle="#333";b.fill();b.fillStyle="#333";b.fillRect(editorWidth-22,a-19,20,20);b.fillStyle="#ddd";b.fillRect(editorWidth-20,a-18,16,16);b.beginPath();b.moveTo(editorWidth-18,a-15);b.lineTo(editorWidth-12,a-4);b.lineTo(editorWidth-6,a-15);b.closePath();b.fillStyle="#333";b.fill()}function scrollBar(b,e){var a=document.getElementById("canvas").height;var d=((a-35)/e)*(a-35-39);if(d<30){d=30}if(d>=a-35-39){d=a-35-39}var c=(vOffset/(e-a))*(a-35-39-d)+35;b.fillRect(editorWidth-22,c,20,d)}function paint(N,q,I){var j=document.getElementById("canvas");var n=j.getContext("2d");n.clearRect(0,0,2000,2500);n.fillStyle=background;n.fillStyle=foreground;n.lineWidth=4;n.strokeStyle="#ddd";n.beginPath();n.moveTo(2,2);n.lineTo(2,document.getElementById("canvas").height-1);n.lineTo(editorWidth,document.getElementById("canvas").height-1);n.lineTo(editorWidth,2);n.stroke();n.font=font;var D=lineheight+50;for(var K=0;K<lines.length;K++){if(!I&&(D-vOffset>1200||D-vOffset<0)){D+=(lineheight*linesNLB[K])}else{var R=lines[K][1];var c=(q?anch.row:pos.row);if(K==pos.row){var w=D-lineheight;if(R=="a"){var x=WrapVariableArray[1][1]}else{if(R=="s"){var x=WrapVariableArray[0][1]}else{if(R=="d"){var x=WrapVariableArray[3][1]}else{if(R=="c"){var x=WrapVariableArray[2][1]}else{if(R=="p"){var x=WrapVariableArray[4][1]}else{if(R=="t"){var x=WrapVariableArray[5][1]}}}}}}var p=true;var h=[]}if(K==anch.row){var u=D-lineheight;var B=true;var a=[]}var L=lines[K][0];if(R=="s"){var A=WrapVariableArray[0];var C=(Math.round((L.length/61)+0.5))*16;n.fillStyle="#ddd";n.fillRect(A[1]-3,(D-12-vOffset),605,C);n.fillStyle=foreground}else{if(R=="a"){var A=WrapVariableArray[1]}else{if(R=="c"){var A=WrapVariableArray[2]}else{if(R=="d"){var A=WrapVariableArray[3]}else{if(R=="p"){var A=WrapVariableArray[4]}else{if(R=="t"){var A=WrapVariableArray[5]}}}}}}var m=L.split(" ");var F=0;if(N||q){var J=[]}linesNLB[K]=0;while(F<m.length){var H=0;if(m.slice(F).join().length<A[0]){var Q=m.slice(F).join(" ");if(A[3]==1){Q=Q.toUpperCase()}if(A[2]==1){n.textAlign="right"}if(Q!=""){n.fillText(Q,A[1],D-vOffset)}n.textAlign="left";F=m.length;for(var z=0;z<A[4];z++){linesNLB[K]=linesNLB[K]+1;D+=lineheight}if(N||q){J.push(Q.length)}if(p){h.push(Q.length)}if(B){a.push(Q.length)}}else{var H=0;while(m.slice(F,F+H).join(" ").length<A[0]){newLineToPrint=m.slice(F,F+H).join(" ");H++;if(A[3]==1){newLineToPrint=newLineToPrint.toUpperCase()}}n.fillText(newLineToPrint,A[1],D-vOffset);linesNLB[K]=linesNLB[K]+1;D+=lineheight;F+=H-1;H=0;var z=1;if(N||q){J.push(newLineToPrint.length)}if(p){h.push(newLineToPrint.length)}if(B){a.push(newLineToPrint.length)}}if(N&&N.clientY+vOffset>(D-6-18*z)&&N.clientY+vOffset<(D+19-18*z)){pos.row=K;pos.col=0;for(var P=0;P<J.length-1;P++){pos.col+=J[P]+1}if(R!="t"){pos.col+=Math.round(((N.clientX-A[1])/fontWidth))}else{pos.col-=Math.round(((A[1]-N.clientX)/fontWidth));pos.col+=lines[K][0].length}var v=0;for(var P=0;P<J.length;P++){v+=J[P]+1}if(pos.col>v){pos.col=v-1}if(pos.col<0){pos.col=0}}if(q&&q.clientY+vOffset>(D-6-18*z)&&q.clientY+vOffset<(D+19-18*z)){anch.row=K;anch.col=0;for(var P=0;P<J.length-1;P++){anch.col+=J[P]+1}if(R!="t"){anch.col+=Math.round(((q.clientX-A[1])/fontWidth))}else{anch.col-=Math.round(((A[1]-q.clientX)/fontWidth));anch.col+=lines[K][0].length}var v=0;for(var P=0;P<J.length;P++){v+=J[P]+1}if(anch.col>v){anch.col=v-1}if(anch.col<0){anch.col=0}}}var p=false;var B=false}}var O=new Date();var o=O.getMilliseconds();var r=o-milli;var g=false;if(r>0&&r<500){g=true}if(r<0&&r<-500){g=true}if(g&&h){var E=0;var l=pos.col;var k=h[E];while(pos.col>k){E++;k+=1+h[E]}k-=h[E];var s=x+((pos.col-k)*fontWidth);if(lines[pos.row][1]=="t"){s-=lines[pos.row][0].length*fontWidth}var G=2+w+(E*lineheight)-vOffset;n.fillRect(s,G,1,20)}if(anch.row!=pos.row||anch.col!=pos.col){if(a){var E=0;var l=anch.col;var k=a[E];while(anch.col>k){E++;k+=1+a[E]}k-=a[E];var R=lines[anch.row][1];if(R=="s"){anchorX=WrapVariableArray[0][1]}else{if(R=="a"){anchorX=WrapVariableArray[1][1]}else{if(R=="c"){anchorX=WrapVariableArray[2][1]}else{if(R=="d"){anchorX=WrapVariableArray[3][1]}else{if(R=="p"){anchorX=WrapVariableArray[4][1]}else{if(R=="t"){anchorX=WrapVariableArray[5][1]}}}}}}var s=anchorX+((anch.col-k)*fontWidth);if(lines[anch.row][1]=="t"){s-=lines[anch.row][0].length*fontWidth}var G=2+u+(E*lineheight)-vOffset;n.fillStyle="red";n.fillRect(s,G,1,20);n.fillStyle=foreground}}var b=50;for(var K=0;K<scenes.length;K++){n.fillText(scenes[K],editorWidth+20,b);b+=lineheight}n.fillStyle="#6484df";n.fillRect(0,0,document.getElementById("canvas").width,35);n.fillStyle="#efefef";n.fillRect(10,7,110,20);n.fillStyle=foreground;n.font="12pt Arial";var M=lines[pos.row][1];if(M=="s"){var t="Slugline"}else{if(M=="a"){var t="Action"}else{if(M=="c"){var t="Character"}else{if(M=="d"){var t="Dialog"}else{if(M=="p"){var t="Parenthetical"}else{if(M=="t"){var t="Transition"}}}}}}n.fillText(t,15,23);n.font=font;n.fillStyle=foreground;n.fillRect(200,7,110,20);if(formatMenu){n.fillStyle="#efefef";n.fillRect(10,7,110,120);n.fillStyle=foreground;n.font="12pt Arial";formatMenuY=23;for(var K=0;K<formats.length;K++){n.fillText(formats[K],15,formatMenuY);formatMenuY+=19}}scrollArrows(n);scrollBar(n,D)};