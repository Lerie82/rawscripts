$(document).ready(function(){document.getElementById("script").style.height=$("#container").height()-65+"px";document.getElementById("script").style.width=$("#container").width()-300+"px";document.getElementById("sidebar").style.height=($("#container").height()-65)+"px";$(":radio").click(function(){radioClick(this)})});$(window).resize(function(){document.getElementById("script").style.height=$("#container").height()-65+"px";document.getElementById("script").style.width=$("#container").width()-300+"px";document.getElementById("sidebar").style.height=($("#container").height()-65)+"px"});function setup(){resource_id=window.location.href.split("=")[1];var e=document.getElementsByTagName("input");var d=e[e.length-1].value.substr(1);if(d!="1"){$.post("/revisionlist",{resource_id:resource_id,version:d},function(c){buildTable(c)})}$.post("/revisionget",{resource_id:resource_id,version:"latest"},function(c){if(c=="not found"){}document.getElementById("scriptcontent").innerHTML=c});var e=document.getElementsByTagName("input");var b=0;var a=false;for(i in e){if(e[i].type=="radio"&&e[i].value.substr(0,1)==2){if(!a){e[i].checked=true;a=true}else{e[i].disabled=true;e[i].style.visibility="hidden"}}else{if(e[i].type=="radio"&&e[i].value.substr(0,1)==1){if(b==0){e[i].disabled=true;e[i].style.visibility="hidden";b++}else{if(b==1){e[i].checked=true;b++}}}}}}function radioSetup(){var e=document.getElementsByTagName("input");var d=false;var b=false;var a=false;for(i in e){if(e[i].type=="radio"){if(e[i].checked&&e[i].value.substr(0,1)==1){d=true}if(e[i].checked&&e[i].value.substr(0,1)==2){b=true}if(!a){e[i].disabled=true;e[i].style.visibility="hidden";a=true}else{if((!d&&e[i].value.substr(0,1)==2)){e[i].disabled=false;e[i].style.visibility="visible"}else{if(b&&e[i].value.substr(0,1)==1){e[i].disabled=false;e[i].style.visibility="visible"}else{e[i].disabled=true;e[i].style.visibility="hidden"}}}}}}function radioClick(e){if(document.getElementById("sel").selectedIndex==1){var f=document.getElementsByTagName("input");for(i in f){if(f[i].type=="radio"){if(f[i].parentNode.className=="viewScript"){f[i].checked=false}}}e.checked=true;f=e;while(f.nodeName!="TR"){f=f.parentNode}changeVersion(e.value,f.id)}else{var a=e.value.substr(0,1);var f=document.getElementsByTagName("input");for(i in f){if(f[i].type=="radio"&&f[i].value.substr(0,1)==a){f[i].checked=false}if(f[i].type=="radio"&&f[i].value.substr(0,1)!=a&&f[i].checked){var d=f[i].value;var b=f[i];while(b.nodeName!="TR"){b=b.parentNode}version_two_id=b.id}}e.checked=true;b=e;while(b.nodeName!="TR"){b=b.parentNode}version_one_id=b.id;compareVersions(e.value,version_one_id,d,version_two_id);radioSetup()}}function buildTable(j){var f=document.getElementById("tb");var g=JSON.parse(j);for(i in g){var h=f.appendChild(document.createElement("tr"));h.id=g[i][0];h.className=(g[i][3]==0?"manualsave":"autosave");var c=h.appendChild(document.createElement("td"));c.align="center";c.className="viewScript";var b=c.appendChild(document.createElement("input"));b.type="radio";b.value="1"+g[i][2];c=h.appendChild(document.createElement("td"));c.align="center";c.className="compare";b=c.appendChild(document.createElement("input"));b.type="radio";b.value="2"+g[i][2];b.disabled=true;b.style.visibility="hidden";c=h.appendChild(document.createElement("td"));c.align="center";c.appendChild(document.createTextNode(g[i][2]));c=h.appendChild(document.createElement("td"));c.align="center";c.appendChild(document.createTextNode(g[i][1]));c=h.appendChild(document.createElement("td"));c.align="center";var e=c.appendChild(document.createElement("a"));e.appendChild(document.createTextNode("Copy to new script"));e.href="javascript:copyThisVersion("+g[i][2]+")"}$(":radio").unbind("click");$(":radio").click(function(){radioClick(this)})}function changeVersion(a,b){$.post("/revisionget",{resource_id:b,version:String(a).substr(1)},function(c){if(c=="not found"){}document.getElementById("scriptcontent").innerHTML=c})}function compareVersions(h,d,g,b){var c=(h>g?g:h);var f=(h<g?g:h);var e=(h>g?b:d);var a=(h<g?b:d);$.post("/revisioncompare",{v_o:c.substr(1),v_o_id:e,v_t:f.substr(1),v_t_id:a},function(j){if(j=="not found"){}document.getElementById("scriptcontent").innerHTML=j})}function compareToggle(e){if(e==0){$(".compare").css("display","block");radioSetup();var k=document.getElementsByTagName("input");for(i in k){if(k[i].type=="radio"){if(k[i].type=="radio"&&k[i].checked){if(k[i].value.substr(0,1)==1){var b=k[i].value;var j=k[i];while(j.nodeName!="TR"){j=j.parentNode}var g=j.id}if(k[i].value.substr(0,1)==2){var h=k[i].value;var j=k[i];while(j.nodeName!="TR"){j=j.parentNode}var a=j.id}}}}compareVersions(b,g,h,a);document.getElementById("key").style.display="block"}if(e==1){$(".compare").css("display","none");var k=document.getElementsByTagName("input");for(i in k){if(k[i].type=="radio"){k[i].disabled=false;k[i].style.visibility="visible";if(k[i].type=="radio"&&k[i].checked&&k[i].value.substr(0,1)==1){var e=k[i].value;var j=k[i];while(j.nodeName!="TR"){j=j.parentNode}var f=j.id}}}changeVersion(e,f);document.getElementById("key").style.display="none"}}function copyThisVersion(a){var b=document.getElementById(a);console.log(b);while(b.nodeName!="TR"){b=b.parentNode}$.post("/revisionduplicate",{resource_id:b.id,version:a},function(c){window.open(c)})}function toggleAutosave(a){var b=document.getElementsByTagName("tr");if(a){for(i in b){if(b[i].className=="autosave"){b[i].style.display="none"}}}else{for(i in b){if(b[i].className=="autosave"){b[i].style.display="table-row"}}}}function duplicate(){$.post("/duplicate",{resource_id:resource_id,fromPage:"editor"},function(a){if(a=="fail"){return}else{window.open(a)}})}function exportPrompt(){document.getElementById("exportpopup").style.visibility="visible"}function hideExportPrompt(){typeToScript=true;document.getElementById("exportpopup").style.visibility="hidden"}function exportScripts(){var e=window.location.href;var g=e.split("=")[1];if(g=="demo"){nope();return}else{var j;var h="&title_page="+document.getElementById("et").selectedIndex;var f=document.getElementsByTagName("input");for(var k=0;k<f.length;k++){if(f[k].checked==true){if(f[k].className=="exportList"){j=f[k].name;e="/export?resource_id="+g+"&export_format="+j+"&fromPage=editor"+h;window.open(e)}}}}};